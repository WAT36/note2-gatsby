{"componentChunkName":"component---src-templates-note-js","path":"/programming/013_procon/002_data_structure/binary_indexed_tree/","result":{"data":{"site":{"siteMetadata":{"title":"WAT Note(II)"}},"markdownRemark":{"id":"a0e1f5ca-35b6-5d93-aaf3-3fdda2e137bd","excerpt":"Binary Indexed Tree(BIT)は、セグメント木を応用したデータ構造で、リスト(数列)anが与えられた時、次のことが行える。 iが与えられた時、a1…aiの和を計算する。 i,xが与えられた時、ai+=xとする。 BIT…","html":"<p>Binary Indexed Tree(BIT)は、セグメント木を応用したデータ構造で、リスト(数列)a<sub>n</sub>が与えられた時、次のことが行える。</p>\n<ul>\n<li>iが与えられた時、a<sub>1</sub>…a<sub>i</sub>の和を計算する。</li>\n<li>i,xが与えられた時、a<sub>i</sub>+=xとする。</li>\n</ul>\n<p>BITをどのように表すかだが、セグメント木と同様に、リストの各要素を木の葉の要素にならべる。</p>\n<p>例として、以下のリストをBITで表すと、以下のような図で表される。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">a=[5,2,3,7,4,1,9,10]</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/fee18dadf757c8986373c8526a00531c/f7616/bit1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABi0lEQVQoz2WTh6oCUQxE7///kogVe++KvYsFCwrWPM48VpY1cLluNslMZlb3+XyMQ3C/328d4ng8Wi6Xs2KxaOVy2S6Xi/Jejb/P++38yWAsFguLRCI2GAwsFovZdrv9qQn2O//Dfr+36XRqh8PBdrudnc9n5SaTie7T6aSh5AG7Xq8/ZJy3HixqtZpls1lLpVLftYNsXq+XJZNJ1SDFarX6yvBlSAyHQyuVStbr9TTUH8Hh8XjcqtWqhrKRH9CxQrfb1aDNZqNVRqORNRoNFT8eDxXf7/cvKKzm87ktl0sNrtfrkkMMQet0OpZIJOQqkclkLJ/Py4hms6kcTeQBYlUC4HQ6raH0I4erVCpWKBSk3/P5VOF4PFYzK3mfCjfNHEwjYM/nFI1Gbb1e/zNstVpahxv3PDaeo7An+v2+msjDEr1ms5lkgAg9t9vNHIgM43uDEYjIgFawZBWeObxnI96FQiG5TT/yhMNh1Tr0wAj+EaCAShH6YBRyYBrOA4xRDGi329ISqch5xP4A2xMpwqT7jNYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"BIT例1\"\n        title=\"BIT例1\"\n        src=\"/note2-gatsby/static/fee18dadf757c8986373c8526a00531c/f058b/bit1.png\"\n        srcset=\"/note2-gatsby/static/fee18dadf757c8986373c8526a00531c/c26ae/bit1.png 158w,\n/note2-gatsby/static/fee18dadf757c8986373c8526a00531c/6bdcf/bit1.png 315w,\n/note2-gatsby/static/fee18dadf757c8986373c8526a00531c/f058b/bit1.png 630w,\n/note2-gatsby/static/fee18dadf757c8986373c8526a00531c/f7616/bit1.png 766w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>BITでは、節点の値にその節点が示す区間の値の和を設定する。</p>\n<p>ここから、例えばi=5を入力した時、a<sub>1</sub>〜a<sub>5</sub>までの和を求めるが、この求め方もセグメント木の時と同様に、a<sub>1</sub>〜a<sub>5</sub>の区間を示す節点を取り出してきて、その値の和を求めれば良い。この例の時、以下のような図で表され、和は17+4=21が返る。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/2fc39dd3a415439c6fe632c28795fa6f/e5715/bit2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2klEQVQoz2VSW47aQBD07XKCfOcrf7lDtIeIlEvkAvmABYwNtkEYbGMHGYwBkwVj8TAr8TAVVSMIaEsaTavVU11dPcrlcgEPwbsoCjnEZrOBaZpot9totVrYbreSv9U8vrvFyv/kleQRSZKgXC5jOBzKvVgsPtQ8kgrhI1mWvSOO58iyHGm6FEVZlmE8HmO1Woni5fKan81myPP8iUwIi+IswWjootv5hob+GXX1B65TXz6o4aiqqkLTNLGBxDcb7gqJKOrDMr/ij/8FuvbziehWfEOtVkO32xXSKIqeGippmiIIAgTBAG9vW0ynS0RRAsfpYTyOcTwepZj3aDSSBc3nc0wmE/HYtm0hX6/XV4XVahW+H6BeryNNr6brugbDMGU0FhOe50recRzZPEFvqbLX64E8bKrwgWVZ0ulwONwLG40GdF2XRRB5/i45EnBBxOl0QqfTkR9A1aLQ8zwh6vf7d9lUwZh2ME+EoY8kmWG324ki+sqFhGGI8/ksk+z3eyhU4bqudOGI7Ej53GCz2YSqanh9/Y1q5RN07TtsO4BlGSiVSrIcWmUYhryvVCpQ+HA6nUqSYzNmE37mwWAgdgSBj2bjBa77C5PJX5imAd/3pSkFxHEsdnCyf2+PJkCCBK+eAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"BIT例2\"\n        title=\"BIT例2\"\n        src=\"/note2-gatsby/static/2fc39dd3a415439c6fe632c28795fa6f/f058b/bit2.png\"\n        srcset=\"/note2-gatsby/static/2fc39dd3a415439c6fe632c28795fa6f/c26ae/bit2.png 158w,\n/note2-gatsby/static/2fc39dd3a415439c6fe632c28795fa6f/6bdcf/bit2.png 315w,\n/note2-gatsby/static/2fc39dd3a415439c6fe632c28795fa6f/f058b/bit2.png 630w,\n/note2-gatsby/static/2fc39dd3a415439c6fe632c28795fa6f/e5715/bit2.png 768w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ここで、BITにおいては、区間内の和を示しているので、実は各節点の2つ目の子になっている節点は必要ないことがわかる。(iが与えられた時は2つ目の子の要素は計算に使わない。i,xが与えられた時でa<sub>i</sub>が親節点の2つ目の子になっていた場合、a<sub>i</sub>を示す節点の値を書き換えなくても、その親節点から上の接点の要素を書き換えれば、その他の計算には影響を与えないため。)</p>\n<p>そのため、BITは以下のようにも置き換えられる。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/6d12b8f7f81938091019fb97e40133e2/f7616/bit3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABf0lEQVQoz2WSCauCUBCF7///T9FC+yJRFFS0EFFhq6Zppc3jG7jis4GL3uF45pzjmO/3KxyKZ5qmeijP86Tb7Uq/3xfHceTxeGS44nf23eSbxdrv91Iul2U+n0u1WpXT6fSDKX5v8pfL5SLb7VbO57Me3/fldrvJbreT6/WqiiG93+8ShmHmJC/G2OZqtZLRaCSdTkeazWYGLqqhDzkD4ziWz+fzq5DabDYyGAxksVhIo9H4IckXSl+vlyp9Pp//sIZJs9lMD3awZy2/3++MDILlcim9Xk9xaZIoGTlDbHGGsCFDFSQU+YRBoM8oirQ3Ho/1j0+nU3VCYRnSOIoUqwoBMpW1AEAlSaI/hAG82yHtdlsHu66b2QR3PB7VgSqcTCZ6seqQPhwO9c7e8QHF6mAPxWRIrddrzZxo7EqZWq2muQVBoGAU00M1tm12pVJJ6vW6RFiMY12vSqWiWNYNLByGXAgVEJMOh4O0Wi0l4W7V08MNETDY9zwdihvudtAfsRlBPaYAc7YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"BIT例3\"\n        title=\"BIT例3\"\n        src=\"/note2-gatsby/static/6d12b8f7f81938091019fb97e40133e2/f058b/bit3.png\"\n        srcset=\"/note2-gatsby/static/6d12b8f7f81938091019fb97e40133e2/c26ae/bit3.png 158w,\n/note2-gatsby/static/6d12b8f7f81938091019fb97e40133e2/6bdcf/bit3.png 315w,\n/note2-gatsby/static/6d12b8f7f81938091019fb97e40133e2/f058b/bit3.png 630w,\n/note2-gatsby/static/6d12b8f7f81938091019fb97e40133e2/f7616/bit3.png 766w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>この図で、灰色の節点は必要のない節点を表す。</p>\n<p>ここで、BITを表すリスト(及び配列)とBITの節点を以下の図のように対応づける。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/c6415f97e3d7197cc0d9d45bcfd72c37/c6bbc/bit4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.12658227848101%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACCUlEQVQoz11T6dLpUBD0/u/gFfxGFcouqHAp+3KDWC4SrpCcnJOkv5ohqG+qTmWb7umemSTwFVEUva9hGPKhcF0XTU1Dq93GdDh85gQKkZKIlPo6Egn8ipg0jiAIcLYsdLpd9Pt9jIZD+EJASRkDGEOoSHhPwm9lFI/HA6PRCO12GztzAyV9hIFiIlLtOA4sy8L1eoUKgg+hLz4Kv5UdDgc0m010Oh3s1uvnd6WAQL1zqOj9fud2vAURYfSSTCGEwHq9xnw+x3a7xel0gu/7fLif0mf7vV4Pu92O3xHG87ynUvEijJtPNlutFg/A3u/5HamgQ8DI96FpGhqahr6ukyZ4QsC53eB6HsLfPSQbi8WClSkhaCKwLxdIKXk4iELs93t28bjf+Zkwt9sNAYmKLVOQ7Fwux4RhGCEQAn90HaVymQHS97GYjDmHhhKFITZ/l8jn81zAlxLu/+tnKFSpUChgMpnwvXd30O92eTiXywWe62IxHqNYLOJ4OnGB1XyOarWKlWEwxrEtJMgKNZ1srVYrnM9nJrBtG7ZlsUVSRCqol5vNhq9b0+TeGYbBuTE2QYpSqRQD6/U6r0ylUsF0OuW1aTQaWC6XKJVKPPlMJoPZbIZsNgvTNFEul5k0nU4zJkEWkskkarUaBoMBLyv9EbQWlEAFiIjuj8d/vAmkhITQ8IyXXV3XOfcHo1KGE89kN5YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"BIT例4\"\n        title=\"BIT例4\"\n        src=\"/note2-gatsby/static/c6415f97e3d7197cc0d9d45bcfd72c37/f058b/bit4.png\"\n        srcset=\"/note2-gatsby/static/c6415f97e3d7197cc0d9d45bcfd72c37/c26ae/bit4.png 158w,\n/note2-gatsby/static/c6415f97e3d7197cc0d9d45bcfd72c37/6bdcf/bit4.png 315w,\n/note2-gatsby/static/c6415f97e3d7197cc0d9d45bcfd72c37/f058b/bit4.png 630w,\n/note2-gatsby/static/c6415f97e3d7197cc0d9d45bcfd72c37/c6bbc/bit4.png 910w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ここで、リストのインデックスを２進数で表したとき、２進数の1桁目が1のところは一番深いところの要素(要素1つ分の区間の節点)を表し、その1つ上の要素はリストのインデックス(２進数)の1桁目が1で2桁目が1である・・・というように表せる。BITでは、この性質を用いて計算をすることが多い。</p>\n<p>ではまず、このデータ構造を用いて、「iが与えられた時、a<sub>1</sub>…a<sub>i</sub>の和を計算する」方法を以下に示す。</p>\n<p>a<sub>i</sub>までの和を求めるには、iの２進数表記の数を利用して、以下のように行う。</p>\n<ol>\n<li>a[i]の値を加える。</li>\n<li>iの２進数表記において、一番下の”1”を減算する。(i -= i &#x26; -i)</li>\n<li>i==0なら1.で加えた値を出力して終了する。そうでない場合は1.へ戻る</li>\n</ol>\n<p>例えばi=7の時は以下の通り。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/d431a2226283b9eb81004f03869a1917/7a18f/bit5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.405063291139236%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABm0lEQVQoz12SaY7aQBCFfdmcJBfIBaIoygHyZ+Z3EhHWDDCBEZjFxpjBGAZDx/vaX+R2iDJ5Uut1VXc/vapqTUpJjZpv+xpJEvMwHPI4HhMHQX0ByhJZr6Jo4v9QSYl2E7thY96jz+9IogT/l8D3fbIsQ1yvihtIfD/ky9jg26NJa7Lh4AXq5JXg9eoznbxjqX8gzyTISuWFCAiCQLkuaneA5wk+3nX4dN/l/eevPDytkFWJVlXNo/1+T6/X4+wKFYdRiCzg6E7odd5wdGZNPgwpi4IiTbmejwSXI6axZjQcsl6v0W7ubNtWomkU4J1fEEKoXh2cLbbdJ418vPMWITxkJSniiInhMDAujEZjDHNDnudNyWVZ0u12OZ1OZHHMoN9jt9uRRiE/+gNc90Iep3S+v+X5+SdZWkJV4IiUvnF5NRgtSRJVhmmaHA4HXk4ntpaF4zi4rotlWex2Ns7ewTRX2PYWe2tTlRXIWjhH/vNLtFarRbvdVoLL5RJd1xXX/ZjNZqxWK8Xz+ZzNxmKxWDCdTv/Mmr9izXDhNy5hWQbCio+eAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"BIT例5\"\n        title=\"BIT例5\"\n        src=\"/note2-gatsby/static/d431a2226283b9eb81004f03869a1917/f058b/bit5.png\"\n        srcset=\"/note2-gatsby/static/d431a2226283b9eb81004f03869a1917/c26ae/bit5.png 158w,\n/note2-gatsby/static/d431a2226283b9eb81004f03869a1917/6bdcf/bit5.png 315w,\n/note2-gatsby/static/d431a2226283b9eb81004f03869a1917/f058b/bit5.png 630w,\n/note2-gatsby/static/d431a2226283b9eb81004f03869a1917/40601/bit5.png 945w,\n/note2-gatsby/static/d431a2226283b9eb81004f03869a1917/78612/bit5.png 1260w,\n/note2-gatsby/static/d431a2226283b9eb81004f03869a1917/7a18f/bit5.png 1284w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>次に、「i,xが与えられた時、a<sub>i</sub>+=xとする。」方法だが、これは先ほどと逆で、iに一番下の”1”を加算していく。以下にその手順を示す。</p>\n<ol>\n<li>a[i]にxを加える。</li>\n<li>i==len(a)なら、1.で加えた値を出力して終了する。</li>\n<li>iの２進数表記において、一番下の”1”のビットに1を加算する。(i += i &#x26; -i)</li>\n</ol>\n<p>例えばi=5の時は以下の通り。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/955b2019536f3befbc3aa927af2d3fac/21b4d/bit6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0UlEQVQoz22SyY7TQBRF8598Bf/AArasWSBYsEIibIAIBKhFFKmTtBxncOLYGTwk7kyOHc92Dqoy3QKJJ5VKerp167xb1eBPXa9X/i5FecWP70847tZ1oyy5liVVUQg1ur3j7ecenzoazZsR9r0vZY0HM7HiOGa/3xFFKY4zZGF+47jfEl1CsjQVQqqylIa/BiZPXzZ5/qbFs9dfUA23NnwgK8uSgarSvb3lfDz+Q5skJWEYUEg6oKqIwoA0CnCsFXtvw2q5wDTNmtD3febzuWz4pxNpmlJkKUkUslx+wDR+UuRXkiQhyzI5fhBeOIcR7sZjtbY5nk4EQVAbbjYbut0ux3tPAkRxLA3zpOTu7gUz7Z3sx0ksYxGEYnddV549+/7jNI08zxmNRmy3WymcT6cYpkFVgLW8QdO+CiBca8V4PJb01zyj3W7TbDZptVr0+30ZmYivIQSdTgfP8yiyjJGqMp1NydOK8fAjk8l7RHTzqYaiKESXC1EQyBFFVIJUeFRVVRMeDgds22a9XmNZFovFAsdxME0Dy9pimDa6PpMawzAkpZzmPyUJBfZwOJTCwWAgKcTj9Ho9NG2Cqiqoqoqu67IvshYX149dPX65h9/yG9i5nwwTrguAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"BIT例6\"\n        title=\"BIT例6\"\n        src=\"/note2-gatsby/static/955b2019536f3befbc3aa927af2d3fac/f058b/bit6.png\"\n        srcset=\"/note2-gatsby/static/955b2019536f3befbc3aa927af2d3fac/c26ae/bit6.png 158w,\n/note2-gatsby/static/955b2019536f3befbc3aa927af2d3fac/6bdcf/bit6.png 315w,\n/note2-gatsby/static/955b2019536f3befbc3aa927af2d3fac/f058b/bit6.png 630w,\n/note2-gatsby/static/955b2019536f3befbc3aa927af2d3fac/40601/bit6.png 945w,\n/note2-gatsby/static/955b2019536f3befbc3aa927af2d3fac/78612/bit6.png 1260w,\n/note2-gatsby/static/955b2019536f3befbc3aa927af2d3fac/21b4d/bit6.png 1280w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>では、これら一連のデータ構造と動作をコードで実装してみよう。例を以下に示す。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">BinaryIndexedTree</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\">#BITを表すリストaを入力</span>\n        <span class=\"token comment\">#ただしaの長さは2**nとする</span>\n        <span class=\"token comment\">#数合わせのためにa[1]~a[len(a)]をBITとする</span>\n        self<span class=\"token punctuation\">.</span>bit<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        self<span class=\"token punctuation\">.</span>bit<span class=\"token punctuation\">.</span>extend<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        ans<span class=\"token operator\">=</span><span class=\"token number\">0</span>\n        <span class=\"token keyword\">while</span> i<span class=\"token operator\">></span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            ans<span class=\"token operator\">+=</span>self<span class=\"token punctuation\">.</span>bit<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n            i <span class=\"token operator\">-=</span> i <span class=\"token operator\">&amp;</span> <span class=\"token operator\">-</span>i\n        <span class=\"token keyword\">return</span> ans\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">while</span> i<span class=\"token operator\">&lt;</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>bit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>bit<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">+=</span>x\n            i <span class=\"token operator\">+=</span> i <span class=\"token operator\">&amp;</span> <span class=\"token operator\">-</span>i</code></pre></div>\n<p>例で用いたBITをこのコードに入力すると、以下のようになる。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">a<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">17</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span><span class=\"token number\">41</span><span class=\"token punctuation\">]</span>\nbit_a<span class=\"token operator\">=</span>BinaryIndexedTree<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#i=7までのaの和</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a[7]までの和:{}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>bit_a<span class=\"token punctuation\">.</span><span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"加える前のBIT:{}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>bit_a<span class=\"token punctuation\">.</span>bit<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#a[5]に1を足す</span>\nbit_a<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"加えた後のBIT:{}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>bit_a<span class=\"token punctuation\">.</span>bit<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>実行結果</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">a[7]までの和:31\n加える前のBIT:[5, 7, 3, 17, 4, 5, 9, 41]\n加えた後のBIT:[5, 7, 3, 17, 5, 6, 9, 42]</code></pre></div>","frontmatter":{"title":"Binary Indexed Tree","date":"November 01, 2019","description":"","tags":[]}}},"pageContext":{"id":"a0e1f5ca-35b6-5d93-aaf3-3fdda2e137bd"}},"staticQueryHashes":["2841359383","3257411868"]}
{"componentChunkName":"component---src-templates-note-js","path":"/programming/013_procon/002_data_structure/segment_tree/","result":{"data":{"site":{"siteMetadata":{"title":"WAT Note(II)"}},"markdownRemark":{"id":"a3aa330b-4e98-5546-8235-dc494e233049","excerpt":"セグメント木は区間と二分木を組み合わせたようなデータ構造である。例えば長さ8のリストをセグメント木で表すと以下のようになる。  ここで、セグメント木の節点にどのようなデータを持たせるかによって、様々な機能を持つ木を作ることができる。 ここでは、RMQ(Range Minimum Query…","html":"<p>セグメント木は区間と二分木を組み合わせたようなデータ構造である。例えば長さ8のリストをセグメント木で表すと以下のようになる。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/35bc716f0181943cd23a085bdc3f5448/e5715/segment_tree1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmElEQVQoz22SB4tCQQyE9///HBEb9q7YfSoqYi/YUGwoao4vx4qnF1h2N5mXnck883w+hUWwPx4PXcTpdJJkMimpVEp37hb3+Z09m/fkZywWC3G73dLtdnVfLpdfmM/vzfvleDzKbDaT3W4n6/Va9vu9bDYb6fV6slqt9M4OUx67XC5fZIyVN51OJR6PSzgcllAoJPf7/V824CORiI4hk8loY8L2MRYMs2AwKMViUZu+hwXb8Pv9UiqVtPFwOPzzoEEGktrttsqB6Wg0kmazKePxWK7Xq4Jvt5vmq9WqsqIGiXq9Lo1GQw6Hwy9Dl8slsVhMWc3nc00mEgnx+Xzi9XqVCdFqtdSYQCAg2WxWc4PBQDwej/4BsEWJqVQqOrtCofAaMkCa8tB2u30ZBi4ajaoSyzqfz+uo7CwNdCkgGWcJcjTCbaQTjAUFOOw4jrJBdr/fVwMhdj6fxUC/VqupY7lcTgtIgDE16zyuUi+Xy8qePwGcxWImZ8NlMpnorGjGoGkEIxbnTqej0mALNp1OqyKaYBI5+pD7AWsXJlBfKDwjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"セグメント木例1\"\n        title=\"セグメント木例1\"\n        src=\"/note2-gatsby/static/35bc716f0181943cd23a085bdc3f5448/f058b/segment_tree1.png\"\n        srcset=\"/note2-gatsby/static/35bc716f0181943cd23a085bdc3f5448/c26ae/segment_tree1.png 158w,\n/note2-gatsby/static/35bc716f0181943cd23a085bdc3f5448/6bdcf/segment_tree1.png 315w,\n/note2-gatsby/static/35bc716f0181943cd23a085bdc3f5448/f058b/segment_tree1.png 630w,\n/note2-gatsby/static/35bc716f0181943cd23a085bdc3f5448/e5715/segment_tree1.png 768w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ここで、セグメント木の節点にどのようなデータを持たせるかによって、様々な機能を持つ木を作ることができる。</p>\n<p>ここでは、RMQ(Range Minimum Query)を実現するセグメント木を例として見ていく。</p>\n<p>RMQとは、リスト(及び数列)上で、指定した区間内の最小値を求めるという問題である。</p>\n<p>まず、例として以下のような数列があったとする。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">a=[5,2,3,7,4,1,9,10]</code></pre></div>\n<p>この数列において、i,j(0≦i≦j&#x3C;|a|)を入力したときに、a[i]からa[j]の区間内での最小値を求めることを考えてみよう。</p>\n<h2>セグメント木を使った最小値の求め方</h2>\n<p>この数列をセグメント木で、節点にその節点が示す区間の最小値を入力すると以下のようになる。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/cff127640d453a9df65cbb5df07f0007/167b5/segment_tree2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.53164556962025%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABh0lEQVQoz22SV28CMRCE/f//0j3Qe+8gihBVdBA80Df6JnJ0IVnJ8nlv1jsza/d+v41FsL9eLy3ifD5buVy2drut/XQ6Ke8x4Tr/7cLJz1itVhaPx20+n2tfLpd/MJ/1Lnw4Ho82mUxss9nYbrcTo/1+b9Pp1Lbbrc7sHucZh8k4L282m0lWpVKxZDJpj8fD/ovn82nZbNaazabV63U18zb8MCSQk8lkbDgcWjqd/nWJB/tIpVKyAQLgw/Idkvr9voxHDkC61mo1G41Gdr1eBb7f7zoXi0U1R/JisRAOVYfD4ZshZkMfdoAIGCKnWq1aoVBQrtPpWC6Xs/F4LMkEeHIQgjXNXbfb1QUU3243AWEJkMUACMD5fF6NGZi3gsbRaFQvQgxJMIBer2fr9VrJVqulSXNZo9FQIV5hxeVy0SU0Z5CDwUD1EOLdOjpyiEQiFovF5Am7Z8j/IAgskUjozCDIgfGLPP/BOWRgbqlUkrlQxyMY4RcewoJh4CNYLiAHHjIMiRyD/QL0ASqamy5sPQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"セグメント木例2\"\n        title=\"セグメント木例2\"\n        src=\"/note2-gatsby/static/cff127640d453a9df65cbb5df07f0007/f058b/segment_tree2.png\"\n        srcset=\"/note2-gatsby/static/cff127640d453a9df65cbb5df07f0007/c26ae/segment_tree2.png 158w,\n/note2-gatsby/static/cff127640d453a9df65cbb5df07f0007/6bdcf/segment_tree2.png 315w,\n/note2-gatsby/static/cff127640d453a9df65cbb5df07f0007/f058b/segment_tree2.png 630w,\n/note2-gatsby/static/cff127640d453a9df65cbb5df07f0007/167b5/segment_tree2.png 776w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ここで、区間を示す値i,jを入力したとき、どのようにして最小値を求めれば良いか。</p>\n<p>方法は、セグメント木中で区間[i,j]を示すような値を取り出し、その最小値を求めれば良いのである。</p>\n<p>例えば、i=1,j=4の時は、以下のセグメント木の黄色い節点が[1,4]を示すことになり、この値の最小値「2」が区間[i,j]の最小値となる。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/33db7ce4b8661eacde2c185add522014/e5715/segment_tree3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8ElEQVQoz2VTS47aUBD0xbKJss5ZcoGsZmafI+QI2WQRjcBgwF/wH/PHZgALho/BQpN4bKioO/KIDC09+bldr7uq+lm4XC6gRUHP8/nMi+JwOMA0TQwGA1iWhePxyPkSc32u3AvXyfexXC7RaDSwWCxQr9exXq9vMO/PC9cvu90Os9kMm82G92maIkkSzOdz7Pd7ZkjfiDnhSsbXZIRS3nQ6ZVm0FEVBUeQEvWFE+FarhSAI4DgOsy/zbwwpqKOu6xiNRtA07abIdZANcRyj3W4jDMP/5AskgUzv9/vYbrcMjKIZXOcRYeggy3IGZ1mGyWQCwzCwWq2YAGFt22ZVZA0zrNVq6Ha7LOP5ecXJVvMOvvsBhv4RlvWTc77nwjQ7bE2pIIoibjAcDvk8NRVc14WiyHBdD3n+ysCnJxOqcg9V/YY03XHu5eU3F1JVlQdEURQF+yiK4tsNEIhdUZwRBD6S5B/Q83pIkj/Ybk/o9fogC8fjLpbLOU/e8zwuRgMZj8fI85wLn04nCLKswPd9VB4/Q6p/gWUFkKQaOh0DqipDkpoQxV+oi58gt77CtgcwDA2VSgWSJKHZbPIwq9UqyD6BJhXHK+jaA1znO+J4A1mWeXrU3TDaGI2G0NQHBMEPLBZr6LrGvtFfVF4dsoKu0l+WJCXYEMrh9gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"セグメント木例3\"\n        title=\"セグメント木例3\"\n        src=\"/note2-gatsby/static/33db7ce4b8661eacde2c185add522014/f058b/segment_tree3.png\"\n        srcset=\"/note2-gatsby/static/33db7ce4b8661eacde2c185add522014/c26ae/segment_tree3.png 158w,\n/note2-gatsby/static/33db7ce4b8661eacde2c185add522014/6bdcf/segment_tree3.png 315w,\n/note2-gatsby/static/33db7ce4b8661eacde2c185add522014/f058b/segment_tree3.png 630w,\n/note2-gatsby/static/33db7ce4b8661eacde2c185add522014/e5715/segment_tree3.png 768w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>i,jが与えられた時に、セグメント木を使って区間[i,j]の最小値を取り出す方法は、セグメント木の根から以下の手順を再帰的に求める。</p>\n<ul>\n<li>[i,j]とその節点が示す区間が全く交差していなければ、最小値を計算するのに影響しない値を返す。(intの最大値など)</li>\n<li>[i,j]にその節点が示す区間が含まれるならば、その節点の持つ値を返す。</li>\n<li>上の2つのいずれでもない場合は、2つの子ノードについてこの手順を行い、その2つの最小値を返す。</li>\n</ul>\n<h2>セグメント木の値の更新</h2>\n<p>aの要素を更新する時、セグメント木中の節点の値も更新しなければならない。その場合の計算方法はどうすれば良いか？</p>\n<p>これは、セグメント木の葉の要素(a[i])から更新し、その後親要素へ順に最小値を計算、更新させていく。</p>\n<p>例として、a[0]を0と置き換えた時の一連の流れを以下の図に示す。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 506px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/cdf982a93856cbacd6bba7c64b27ab90/29f4e/segment_tree4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.46835443037975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqElEQVQoz21QS0vDYBDMD/ageOkfEBHEgzcPgiJaELwIglA8aJqapI88viZtkqZYIq1VS1vTh0mTjuynDUUd+Mjukp2dGQFrWC6X2XeZpqshEgC1ywuYuU3Ix0f4vbO+J/xHtsJgOoPBGNpPT2BSEVr+DOzhHuFkikUcI47jP2KENE1Bb/3SIkng3N5APDyApSpYrNT+IPr8RKfTga7rcBwH8/n8r8J1NHwf4v4u5NwWnFIxm6dJktWu68I0TUiShNFolM0Fz/Pg+z6CIEAURXCkIu7y53judhHOZmCWDcuy0O/3v2MYDFCv1/ksDEP0ej1UKhUQD+0LhUIBpycnYHULr0GA++0NVHKb6HouJ1DkRzDGYBgG723b5j3ZJdAhWZahKApXyi1TEUcRyoYBVZZhaxrG44/MWqPR4JmtCIiUXBFIJeXYarV4lsJwOMT72xvex2Pc7u1Av7qE5bVQVlVuTRRF/nOpVEK1WuWZNZtNrphUUU81qSa3wmQyQf/lBeFsjmr+DObNNWzXha5raLfbfInUaZrGiVRV5eooQyKp1WpcMamko18455CLkd6FSAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"セグメント木例4\"\n        title=\"セグメント木例4\"\n        src=\"/note2-gatsby/static/cdf982a93856cbacd6bba7c64b27ab90/29f4e/segment_tree4.png\"\n        srcset=\"/note2-gatsby/static/cdf982a93856cbacd6bba7c64b27ab90/c26ae/segment_tree4.png 158w,\n/note2-gatsby/static/cdf982a93856cbacd6bba7c64b27ab90/6bdcf/segment_tree4.png 315w,\n/note2-gatsby/static/cdf982a93856cbacd6bba7c64b27ab90/29f4e/segment_tree4.png 506w\"\n        sizes=\"(max-width: 506px) 100vw, 506px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>コードでの実装例</h2>\n<p>これまでの一連の機能について、セグメント木を(Python)コードで実装した例を以下に示す。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> math\n\n<span class=\"token comment\">#最小値計算に影響を与えないほどの大きい値</span>\nMAX<span class=\"token operator\">=</span><span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span><span class=\"token string\">'inf'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SegmentTree</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\">#初期化,リストaからセグメント木を作成</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\">#n:リストaの長さ</span>\n        self<span class=\"token punctuation\">.</span>n<span class=\"token operator\">=</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">#node:n以上で最小の２の冪乗 - 1（セグメント木の節点の数）</span>\n        self<span class=\"token punctuation\">.</span>node<span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token operator\">**</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>math<span class=\"token punctuation\">.</span>log2<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>n<span class=\"token punctuation\">)</span><span class=\"token operator\">//</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\n        <span class=\"token comment\">#leaf:セグメント木の葉の数</span>\n        self<span class=\"token punctuation\">.</span>leaf<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token operator\">**</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>math<span class=\"token punctuation\">.</span>log2<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>n<span class=\"token punctuation\">)</span><span class=\"token operator\">//</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\n        <span class=\"token comment\">#segtree:セグメント木</span>\n        self<span class=\"token punctuation\">.</span>segtree<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>MAX <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>leaf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n        <span class=\"token comment\">#セグメント木の葉にリストの値セット</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>segtree<span class=\"token punctuation\">[</span>self<span class=\"token punctuation\">.</span>node<span class=\"token operator\">+</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>a<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n        <span class=\"token comment\">#セグメント木の節点の値を計算してセット</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>node<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>segtree<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>segtree<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>self<span class=\"token punctuation\">.</span>segtree<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>i<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">#k番目の値をaに変更</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>k<span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        k<span class=\"token operator\">+=</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token operator\">**</span>self<span class=\"token punctuation\">.</span>n<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span>\n        self<span class=\"token punctuation\">.</span>segtree<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>a\n        <span class=\"token comment\">#登りながら更新</span>\n        <span class=\"token keyword\">while</span> k<span class=\"token operator\">></span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            k<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>k<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">//</span><span class=\"token number\">2</span>\n            self<span class=\"token punctuation\">.</span>segtree<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>segtree<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>self<span class=\"token punctuation\">.</span>segtree<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>k<span class=\"token operator\">+</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">#[i,j]の最小値を求める</span>\n    <span class=\"token comment\">#kは節点の番号、l,rはその節点が対応している区間[l,r]のこと。</span>\n    <span class=\"token comment\">#一番最初(根)の時はquery(i,j,0,0,n)とする。</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">,</span>k<span class=\"token punctuation\">,</span>l<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\">#[i,j)と[l,r]が交差しなければ、MAXを返す</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">&lt;=</span>i <span class=\"token keyword\">or</span> j<span class=\"token operator\">&lt;=</span>l<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> MAX\n\n        <span class=\"token comment\">#[a,b]が[i,j]を完全に含んでいれば、節点の値を返す</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">&lt;=</span>l <span class=\"token keyword\">and</span> r<span class=\"token operator\">&lt;=</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>segtree<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\">#そうでない時は、2つの子の最小値を返す</span>\n            vl<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>l<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>l<span class=\"token operator\">+</span>r<span class=\"token punctuation\">)</span><span class=\"token operator\">//</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n            vr<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>k<span class=\"token operator\">+</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>l<span class=\"token operator\">+</span>r<span class=\"token punctuation\">)</span><span class=\"token operator\">//</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> <span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>vl<span class=\"token punctuation\">,</span>vr<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#例で示した値を入力する</span>\na<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span>\nst<span class=\"token operator\">=</span>SegmentTree<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>実行結果</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2</code></pre></div>","frontmatter":{"title":"セグメント木","date":"November 01, 2019","description":"","tags":[]}}},"pageContext":{"id":"a3aa330b-4e98-5546-8235-dc494e233049"}},"staticQueryHashes":["2841359383","3257411868"]}
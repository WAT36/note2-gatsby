{"componentChunkName":"component---src-templates-note-js","path":"/programming/013_procon/002_data_structure/bucket/","result":{"data":{"site":{"siteMetadata":{"title":"WAT Note(II)"}},"markdownRemark":{"id":"9918443d-3523-5767-94fa-b4feaa492895","excerpt":"まずバケット法とは、列、または平面状に散らばったデータをバケットと呼ばれる単位に分割して、バケットにデータを管理させる方法である。例を以下に示す。  平方分割とは、n個の要素を√n個のバケットにまとめて管理する方法のことを言う。 ここでは、セグメント木の時と同様に、RMQ…","html":"<p>まずバケット法とは、列、または平面状に散らばったデータを<strong>バケット</strong>と呼ばれる単位に分割して、バケットにデータを管理させる方法である。例を以下に示す。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/0af4a7caab084b561a4307332bd7a1bd/7e4a6/bucket1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVQoz4WS3Y6aUBSFef9H8A288UJNvFCEM1TbXnSMURlEE0lG5G8Q6jD8BOFroLVNbWa6kp2zd87Za+2sfSTuUNf1h9EgTVO852fSMCQ4HjmfTrwGPoHrICVJQhRFeJ73u+E93O6ruuakCRJ1ylkThIpMosh4uo6kqirdbpdOp8NqtSKOY2zbJgzDVsT3fVzX/ZsYCL9+IWvINEH0oJJ/EsT7HZIsy4xGI4QQ9Pt9hsNhmw8GAxqxXq/HfD4nCAKyLON6vZJmGceZxlmoWJMxrlAI1SmOvkHa7XYsFgs2mw3L5ZL1et3muq63tWmaGIZBWZZ/PAbOvyb8PtOIH1Qu0zHh1kBqHjWql8uFw+HAfr/HcZy2vpHce5gXBe7nOa8zjZcmNNGSuk86UlVV75rfLqCq/tlyURREQYBv2xwtixfHIQ4CHNv+OeH/vsn9eS1L8jxnqiiMJxO+PT5ysKzWJum+4SOym3/12xtFFLE1TbZbo13YDT8A/AehBdoc9BkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"バケット例1\"\n        title=\"バケット例1\"\n        src=\"/note2-gatsby/static/0af4a7caab084b561a4307332bd7a1bd/f058b/bucket1.png\"\n        srcset=\"/note2-gatsby/static/0af4a7caab084b561a4307332bd7a1bd/c26ae/bucket1.png 158w,\n/note2-gatsby/static/0af4a7caab084b561a4307332bd7a1bd/6bdcf/bucket1.png 315w,\n/note2-gatsby/static/0af4a7caab084b561a4307332bd7a1bd/f058b/bucket1.png 630w,\n/note2-gatsby/static/0af4a7caab084b561a4307332bd7a1bd/40601/bucket1.png 945w,\n/note2-gatsby/static/0af4a7caab084b561a4307332bd7a1bd/7e4a6/bucket1.png 952w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>平方分割とは、n個の要素を√n個のバケットにまとめて管理する方法のことを言う。</p>\n<p>ここでは、セグメント木の時と同様に、RMQをこの平方分割で実装する方法についてを考えよう。</p>\n<p>数列a<sub>0</sub>,a<sub>1</sub>,・・・,a<sub>n-1</sub>がある時、次の2つの処理について√n個のバケットを用いて解くことを考える。</p>\n<ul>\n<li>s,tが与えられた時、a<sub>s</sub>,・・・,a<sub>t</sub>の最小値を求める。</li>\n<li>i,xが与えられた時、a<sub>i</sub>の値をxに変更する。</li>\n</ul>\n<p>まず、長さnの数列aを、[√n]個のバケットに分割する。</p>\n<p>前者の最小値を求める処理については、求めたい区間内に完全に含まれているバケットについてはそのバケットの最小値を利用し、求めたい区間にあってかつ属するバケットが完全にその区間に含まれていない要素については、個々の要素の最小値を見る。</p>\n<p>そうすることにより得た値の最小値が、求める区間内での最小値になる。</p>\n<p>後者の値を更新する処理については、要素の値を更新したら、そのバケットの最小値も再度計算し直す。最小値は、そのバケットの最小値と更新した値を比較した小さい方になる。</p>\n<p>以上が、平方分割(バケット法)の方法になる。では、これをコードで実装してみよう。実装例を以下に示す。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> math\nINF<span class=\"token operator\">=</span><span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"inf\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Bucket</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\">#元のリスト</span>\n        self<span class=\"token punctuation\">.</span>a<span class=\"token operator\">=</span>a\n        <span class=\"token comment\">#平方分割用バケット用意</span>\n        b<span class=\"token operator\">=</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>math<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">//</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">#１バケットあたりのデータの個数</span>\n        self<span class=\"token punctuation\">.</span>b<span class=\"token operator\">=</span>b\n        bucket<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        b_start<span class=\"token operator\">=</span><span class=\"token number\">0</span>\n        b_end<span class=\"token operator\">=</span>b\n        <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>b_end<span class=\"token operator\">>=</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                bucket<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">[</span>b_start<span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                bucket<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">[</span>b_start<span class=\"token punctuation\">:</span>b_end<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                b_start<span class=\"token operator\">+=</span>b\n                b_end<span class=\"token operator\">+=</span>b\n        <span class=\"token comment\">#バケット</span>\n        self<span class=\"token punctuation\">.</span>bucket<span class=\"token operator\">=</span>bucket\n    \n    <span class=\"token comment\">#a[s]~a[t]の最小値を求める</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>s<span class=\"token punctuation\">,</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        ans<span class=\"token operator\">=</span>INF\n        x<span class=\"token operator\">=</span>s\n\n        <span class=\"token comment\">#(a[s]~)個々の要素の計算</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">%</span>self<span class=\"token punctuation\">.</span>b <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token keyword\">and</span> x<span class=\"token operator\">&lt;=</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            ans<span class=\"token operator\">=</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>ans<span class=\"token punctuation\">,</span>self<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            x<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n        \n        <span class=\"token comment\">#(a[s]~a[t]が１バケット内のとき)最小値を返す</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">></span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> ans\n        <span class=\"token comment\">#(そうでないとき)バケット計算</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">+</span>self<span class=\"token punctuation\">.</span>b<span class=\"token operator\">&lt;=</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                ans<span class=\"token operator\">=</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>ans<span class=\"token punctuation\">,</span>self<span class=\"token punctuation\">.</span>bucket<span class=\"token punctuation\">[</span>x<span class=\"token operator\">//</span>self<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                x<span class=\"token operator\">+=</span>self<span class=\"token punctuation\">.</span>b\n        \n        <span class=\"token comment\">#(~a[t])個々の要素の計算</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t<span class=\"token operator\">-</span>x<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token operator\">==</span>self<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\">#(a[t]がバケット内の最後の要素であったとき)</span>\n            ans<span class=\"token operator\">=</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>ans<span class=\"token punctuation\">,</span>self<span class=\"token punctuation\">.</span>bucket<span class=\"token punctuation\">[</span>x<span class=\"token operator\">//</span>self<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> ans\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\">#そうでないときは１個ずつ見る</span>\n            <span class=\"token keyword\">while</span> x<span class=\"token operator\">&lt;=</span>t<span class=\"token punctuation\">:</span>\n                ans<span class=\"token operator\">=</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>ans<span class=\"token punctuation\">,</span>self<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                x<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n            <span class=\"token keyword\">return</span> ans\n\n    <span class=\"token comment\">#a[i]をxに変更</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>x\n        <span class=\"token comment\">#a[i]があるバケットのインデックス</span>\n        j<span class=\"token operator\">=</span>i<span class=\"token operator\">//</span>self<span class=\"token punctuation\">.</span>b\n        self<span class=\"token punctuation\">.</span>bucket<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>bucket<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">)</span></code></pre></div>\n<p>試しに、セグメント木のページで利用した例と同じリストを使ってみよう。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">a<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span>\nbuc<span class=\"token operator\">=</span>Bucket<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#a[1]~a[4]までの最小値</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a{0}~a{1}までの最小値:{2}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span>buc<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#a[0]を0に変える</span>\nbuc<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"バケット:{}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>buc<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>実行結果は以下の通り。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">a1~a4までの最小値:2\nバケット:[0, 2, 3, 7, 4, 1, 9, 10]</code></pre></div>","frontmatter":{"title":"バケット法と平方分割","date":"November 01, 2019","description":"","tags":[]}}},"pageContext":{"id":"9918443d-3523-5767-94fa-b4feaa492895"}},"staticQueryHashes":["2841359383","3257411868"]}
{"componentChunkName":"component---src-templates-note-js","path":"/programming/012_machine_learning/003_deep_learning/mnist/","result":{"data":{"site":{"siteMetadata":{"title":"WAT Note(II)"}},"markdownRemark":{"id":"9f7b8a40-d75d-5c74-bbc5-ecf34aefd8e9","excerpt":"ここでは、実用的な問題への応用として、手書き数字をニューラルネットワークを使って認識させてみることを考えてみる。 MNISTデータベース 手書き文字のデータは、MNISTと呼ばれるデータセットを利用する。 MNISTデータセットは、Kerasから以下のように利用することができる。 ここで、x_train…","html":"<p>ここでは、実用的な問題への応用として、手書き数字をニューラルネットワークを使って認識させてみることを考えてみる。</p>\n<h2>MNISTデータベース</h2>\n<p>手書き文字のデータは、<strong>MNIST</strong>と呼ばれるデータセットを利用する。</p>\n<p>MNISTデータセットは、Kerasから以下のように利用することができる。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> keras<span class=\"token punctuation\">.</span>datasets <span class=\"token keyword\">import</span> mnist\n\n<span class=\"token comment\"># trainに60000個の訓練用データ、testに10000個のテストデータが入る</span>\n<span class=\"token punctuation\">(</span>x_train<span class=\"token punctuation\">,</span>y_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>x_test<span class=\"token punctuation\">,</span>y_test<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> mnist<span class=\"token punctuation\">.</span>load_data<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>ここで、x_trainには60000<em>28</em>28の配列変数で、0~255の値をとるデータが入る。</p>\n<p>また、y_trainには60000*1の配列変数で、画像の認識結果である0-9の値が入る。</p>\n<p>例として、データを一つとって図示してみよう。以下にその過程を示す。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#最初のデータだけ図示</span>\nx0 <span class=\"token operator\">=</span> x_train<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># ヒートマップにして表示</span>\nplt<span class=\"token punctuation\">.</span>figure<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span>x0<span class=\"token punctuation\">,</span>interpolation<span class=\"token operator\">=</span><span class=\"token string\">'nearest'</span><span class=\"token punctuation\">,</span>vmin<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>vmax<span class=\"token operator\">=</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span>cmap<span class=\"token operator\">=</span><span class=\"token string\">'binary'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#ちなみに認識結果（目標値）は</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'↑の目標値：{0}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>y_train<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>実行結果</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 253px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/8d300752204a4e7b913da55b7e587424/88c73/Figure_49.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 110.12658227848102%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAACc0lEQVQ4y61VS0tqURg9NRBnTfwDzsR5OU0SxEngHxAnYYPqF4TgOBQcOhEdKU6cWDhp5jBQpEFBkPk231YYpa1Y32UfTr7uvdy7YOM++7G+9T32pwYAz8/PaDabmEwmeH19xcvLy1+Pt7c34dG+vr4wn88xHA7xrxgMBr8ICRLOZjOZc00ZUvuboM70+31onPR6PbTbbX1jkYT7t7e3uLm5QSKRQDAYRCqVwsHBAU5PT8VldU4UUhnlKoXEx8cHIpEIDg8Psbe3B4vFAk3TZOzu7uL8/Bx+vx/pdFq/JwrXuUycnJxgZ2cH29vbMJlMODs7g8vlQjQaXem6EL6/v6NSqcjHImG328Xd3R08Ho8MYjweo1aryZwxNsZZCD8/PyUGRoWLcYzH47DZbEKuwLMqeUtJWeeyUsBxdHQEu92OcDgMijCe+0E4nU5RrVaXXDaSKoOBQABmsxnHx8dotVr6/pLLfCGr6lANpYjIZrOSaZ/Pt2R8o8uKSB1mnC8vL0UlCd1u92qFrDdmjR/KPfWrcH19Da/Xq9fh/v4+crncekI+6sXC5mO/urqSZGxtbQmR0+lEJpPZnBSjy7RGA8lkEg6HQ1dktVoRi8XABCooL5ZiSIJ6vS5FzA0qu7i4kKCHQiFR9PT0pBNRnXLT2ER+ZJlkVLips/xJ19GbA8EGS2I+rUajIXXGuDJh7ERc5y/XWWac8w7XO52O3KEoTcnlAbpLA7SkWtLj46MkjSA5LysB7AEEjaiwaPiPoBhtNBqhVCqhXC4jn89LfdE6FfP/ZdXLWcyuca7R74eHB9zf36NYLKJQKEgs6TZDsFhvvyP8BkgOP76KZku8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Figure 49\"\n        title=\"Figure 49\"\n        src=\"/note2-gatsby/static/8d300752204a4e7b913da55b7e587424/88c73/Figure_49.png\"\n        srcset=\"/note2-gatsby/static/8d300752204a4e7b913da55b7e587424/c26ae/Figure_49.png 158w,\n/note2-gatsby/static/8d300752204a4e7b913da55b7e587424/88c73/Figure_49.png 253w\"\n        sizes=\"(max-width: 253px) 100vw, 253px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>２層フィードフォワードニューラルネットワークでの学習</h2>\n<p>では、このデータをニューラルネットワークを用いて学習させてみよう。まずはデータの前処理を行う。</p>\n<p>MNISTでの入力データは1つにつき28<em>28の配列変数だったので、まずはこれを1</em>784の形に変形させる。</p>\n<p>また、値を実数として扱うためにfloat型に変換し、255で割って0~1の範囲に値を収める。</p>\n<p>そして、目標データもKerasの関数を使って1-of-K符号化法で変換する。</p>\n<p>これらを、テストデータに対しても行わせる。</p>\n<p>以上の流れをコードで実装すると、以下のようになる。(訓練データのみ)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#行列の型を変換</span>\nx_train <span class=\"token operator\">=</span> x_train<span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token number\">60000</span><span class=\"token punctuation\">,</span><span class=\"token number\">28</span><span class=\"token operator\">*</span><span class=\"token number\">28</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#float型に変換</span>\nx_train <span class=\"token operator\">=</span> x_train<span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span><span class=\"token string\">'float32'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#0~1の値に収める</span>\nx_train <span class=\"token operator\">=</span> x_train<span class=\"token operator\">/</span><span class=\"token number\">255</span>\n<span class=\"token comment\">#目標データも1-of-K符号化法で表す</span>\ny_train <span class=\"token operator\">=</span> np_utils<span class=\"token punctuation\">.</span>to_categorical<span class=\"token punctuation\">(</span>y_train<span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>次に、中間層、活性化関数を以下のように定義する。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#ニューラルネットワークの定義</span>\n<span class=\"token keyword\">from</span> keras<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Sequential\n<span class=\"token keyword\">from</span> keras<span class=\"token punctuation\">.</span>layers <span class=\"token keyword\">import</span> Dense<span class=\"token punctuation\">,</span>Activation\n<span class=\"token keyword\">from</span> keras<span class=\"token punctuation\">.</span>optimizers <span class=\"token keyword\">import</span> Adam\n\n<span class=\"token comment\">#モデルの定義</span>\nmodel <span class=\"token operator\">=</span> Sequential<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#784次元を入力とする16個の中間層を定義する。活性化関数はシグモイド関数</span>\nmodel<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Dense<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span>input_dim<span class=\"token operator\">=</span><span class=\"token number\">784</span><span class=\"token punctuation\">,</span>activation<span class=\"token operator\">=</span><span class=\"token string\">'sigmoid'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#10個の出力層を定義する。活性化関数はソフトマックス関数</span>\nmodel<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Dense<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>activation<span class=\"token operator\">=</span><span class=\"token string\">'softmax'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#学習方法の設定。目的関数を交差エントロピー誤差、学習の評価として正答率を計算、アルゴリズムをAdamに設定</span>\nmodel<span class=\"token punctuation\">.</span><span class=\"token builtin\">compile</span><span class=\"token punctuation\">(</span>loss<span class=\"token operator\">=</span><span class=\"token string\">'categorical_crossentropy'</span><span class=\"token punctuation\">,</span>optimizer<span class=\"token operator\">=</span>Adam<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>metrics<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'accuracy'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#学習を行わせる。trainは訓練データ、全データを学習に使う回数:10、validation_dataにテストデータ。(verbose=1で進行状況表示)</span>\nhistory<span class=\"token operator\">=</span>model<span class=\"token punctuation\">.</span>fit<span class=\"token punctuation\">(</span>x_train<span class=\"token punctuation\">,</span>y_train<span class=\"token punctuation\">,</span>epochs<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>batch_size<span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>verbose<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>validation_data<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>x_test<span class=\"token punctuation\">,</span>y_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#学習の評価値を出力</span>\nscore<span class=\"token operator\">=</span>model<span class=\"token punctuation\">.</span>evaluate<span class=\"token punctuation\">(</span>x_test<span class=\"token punctuation\">,</span>y_test<span class=\"token punctuation\">,</span>verbose<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>ここで、学習を行う(model.fit)時は交差エントロピー誤差を勾配法を用いて最小値を計算しにいくのだが、勾配法だと局所解に嵌った場合抜け出せなくなり、正しい最小値が得られないという場合がありうる。</p>\n<p>そこで、別の方法として、<strong>確率的勾配法</strong>という手法を用いてここでは計算を行なっている。</p>\n<p>確率的勾配法とは、複数個のデータセットを用いて勾配を計算しパラメータを更新する方法である。これにより、場合によっては局所解から脱出できることがある。</p>\n<p>確率的勾配法で用いるデータセットの個数として、コードではbatch_size=1000(1000個)と指定している。</p>\n<p>次に、学習させたモデルを用いてテストデータを何個か評価させてみよう。</p>\n<p>評価させるためのコードを以下に示す。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">y<span class=\"token operator\">=</span>model<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span>x_test<span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>figure<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>figsize<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">12</span><span class=\"token punctuation\">,</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>gray<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">12</span><span class=\"token operator\">*</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    plt<span class=\"token punctuation\">.</span>subplot<span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span><span class=\"token number\">12</span><span class=\"token punctuation\">,</span>i<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    x<span class=\"token operator\">=</span>x_test<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>\n    x<span class=\"token operator\">=</span>x<span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span><span class=\"token number\">28</span><span class=\"token punctuation\">)</span>\n    plt<span class=\"token punctuation\">.</span>pcolor<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">-</span>x<span class=\"token punctuation\">)</span>\n    wk<span class=\"token operator\">=</span>y<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>\n    prediction<span class=\"token operator\">=</span>np<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span>wk<span class=\"token punctuation\">)</span>\n    plt<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">(</span><span class=\"token number\">22</span><span class=\"token punctuation\">,</span><span class=\"token number\">25.5</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"%d\"</span> <span class=\"token operator\">%</span> prediction<span class=\"token punctuation\">,</span> fontsize<span class=\"token operator\">=</span><span class=\"token number\">12</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> prediction <span class=\"token operator\">!=</span> np<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span>y_test<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">27</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>color<span class=\"token operator\">=</span><span class=\"token string\">'red'</span><span class=\"token punctuation\">,</span>linewidth<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">27</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>color<span class=\"token operator\">=</span><span class=\"token string\">'yellow'</span><span class=\"token punctuation\">,</span>linewidth<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n    plt<span class=\"token punctuation\">.</span>xlim<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">27</span><span class=\"token punctuation\">)</span>\n    plt<span class=\"token punctuation\">.</span>ylim<span class=\"token punctuation\">(</span><span class=\"token number\">27</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    plt<span class=\"token punctuation\">.</span>xticks<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n    plt<span class=\"token punctuation\">.</span>yticks<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\nplt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  </code></pre></div>\n<p>実行結果</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/90edd54afa2390e40eb0f892d7533520/fdaf8/Figure_50.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC3ElEQVQ4yx2SyW7jVhBF+f+fkE2QAFk10O60rJYty7IGzsPjPD3ykY+ULKudOJsA2Z7AWtTqoIB7q46hBo++ConXW8664OOjY7f/SpGYNEeHeciZ5pjWdWl9n3T7QuO6hE8bAv+RIFiTZFtq4WB+/YYhuz1q9BD5A8PocbnEiMUjKvIYzja98lCDTfGyZYoE5zBi8H2Spyfk3qI3XertgSkUJKsVRp4IZFtT5Al6UEyD4jSNDL2kLFL6rqUpC1zTwndsBtWilSITgq6pb1NmKbrviTwPQx9cxjjg2/IXxiTgHAnS1QYtAnyxYEoFZ1fQHk2UCPj5kdILl3K7Q/s+neNQ7fdIxyFcLDBO55C2tfmx+o25SG51euWipwjfWzKfEl4vMa1loeKQ698Zpyoh3WzpXIfaMmksExUEhPdLjKz0eHvXvP8z0zclqqx4fVN0Q8G///3F9X1Cqowuz6nThGluGWWDblq6tGAsG1RWMckOmWUY5XqPtDyao80pzVCfn3zeMfgRox0yiZSTSGlMG10kSG0xFoJybzKfYl7fcoY5YG5Sur2N8fj9D8LjM+nLjj4KqW0bZ7XCf15TJkdUKhgjgb1cEjxviI5ruijAf1hzvVRc32rC8IlBCsYqwGgGC61SovUGHae8FTW9GzJkMUH+wNTkTCJhjAWN5zM4EUMksO6XtNKhqE30p6fKZ/HwK4YUOXWckXg+p7Pi9TrQ65J57gl3NpdRc1I9k5R0TUU7pChZE1rW7YZdWtJnFV1WcvjxhJGbR9owxF9vkFXE+VxSFBZ17qGTlDHLUEJQux59lvB98Tsqj5FBSG5ZNIHPYXlPJz6TRxifdhe7F/w/75lViOwONNsD2gso1s+86gQ1mcijSRc4VHLDe1/eePy5u93emA4C7C9fMJIkoa4qDocDsm2p65q6qWnbFhFFaK3Ro0ZKeWNN0zDPM9frFcuyyLKMcRxJ05S7uzv+B1yEf32csjysAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Figure 50\"\n        title=\"Figure 50\"\n        src=\"/note2-gatsby/static/90edd54afa2390e40eb0f892d7533520/f058b/Figure_50.png\"\n        srcset=\"/note2-gatsby/static/90edd54afa2390e40eb0f892d7533520/c26ae/Figure_50.png 158w,\n/note2-gatsby/static/90edd54afa2390e40eb0f892d7533520/6bdcf/Figure_50.png 315w,\n/note2-gatsby/static/90edd54afa2390e40eb0f892d7533520/f058b/Figure_50.png 630w,\n/note2-gatsby/static/90edd54afa2390e40eb0f892d7533520/fdaf8/Figure_50.png 674w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>黄線が正しく認識できたデータ、赤線が認識できなかったデータを表しているが、この結果を見ると、うまく認識されていないケースが多いように見える。</p>\n<p>そのため、どこか改良してみることを考えてみよう。ここでは、途中の活性化関数を別のものにさせてみる。</p>\n<h2>ReLU活性化関数</h2>\n<p>活性化関数として、シグモイド関数ではなくReLU (Rectified Linear Unit)関数を用いてみることを考えてみよう。</p>\n<p>ReLU関数とは以下の式で表される関数である。</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable width=\"100%\"><mtr><mtd width=\"50%\"></mtd><mtd><mrow><mi>h</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.36em\" columnalign=\"left left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>x</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>></mo><mn>0</mn><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo stretchy=\"false\">(</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr></mtable></mrow></mrow></mtd><mtd width=\"50%\"></mtd><mtd><mtext>(1)</mtext></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\tag{1}  h(x)\n    \\begin{cases}\n        x &#x26; (x>0) \\\\\n        0 &#x26; (otherwise)\n    \\end{cases}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3em;vertical-align:-1.25em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">{</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.69em;\"><span style=\"top:-3.69em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.19em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:1em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.69em;\"><span style=\"top:-3.69em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">)</span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">er</span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">se</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.19em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"tag\"><span class=\"strut\" style=\"height:3em;vertical-align:-1.25em;\"></span><span class=\"mord text\"><span class=\"mord\">(</span><span class=\"mord\"><span class=\"mord\">1</span></span><span class=\"mord\">)</span></span></span></span></span></span></div>\n<p>シグモイド関数は入力値がどのように変化しても常に1に近い値を出力するので、入力の変化が出力に反映されにくくなる。</p>\n<p>その結果、誤差関数の偏微分が0に近い値になり、勾配法による学習が遅くなるという欠点があった。</p>\n<p>そのため、このようなReLU関数を用いることで、その問題を解決することが可能になる。</p>\n<p>では、先程のコードで、中間層の活性化関数を’relu’に変えて実行してみよう。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#モデルの定義</span>\nmodel <span class=\"token operator\">=</span> Sequential<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#784次元を入力とする16個の中間層を定義する。活性化関数はReLU関数</span>\nmodel<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Dense<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span>input_dim<span class=\"token operator\">=</span><span class=\"token number\">784</span><span class=\"token punctuation\">,</span>activation<span class=\"token operator\">=</span><span class=\"token string\">'relu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#10個の出力層を定義する。活性化関数はソフトマックス関数</span>\nmodel<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Dense<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>activation<span class=\"token operator\">=</span><span class=\"token string\">'softmax'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#学習方法の設定。目的関数を交差エントロピー誤差、学習の評価として正答率を計算、アルゴリズムをAdamに設定</span>\nmodel<span class=\"token punctuation\">.</span><span class=\"token builtin\">compile</span><span class=\"token punctuation\">(</span>loss<span class=\"token operator\">=</span><span class=\"token string\">'categorical_crossentropy'</span><span class=\"token punctuation\">,</span>optimizer<span class=\"token operator\">=</span>Adam<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>metrics<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'accuracy'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>こちらで先ほどと同じようにテストデータを評価すると以下のようになる。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/note2-gatsby/static/d6bbc50b8f57760f49a4a16adb307122/fdaf8/Figure_51.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC3ElEQVQ4yx2TyW7jRgAF+f+fkEuQHAIECDyOPYpsS9ZoISmRau5Lk2w2u0kt1jhGLrnkVsH48FD1AfUcPQT0vSBNV1wuJR8fivXmjjJ1aXY+01AwTgnt4UAbhGSrbzSHA2K55Pj0zPF1QVqskPEe9+4ep11s0FFAkj0xDAHXS0I8e0b7Ab3r09cB2vhUzYrxHHP5iDDFkWS+QBmXYQxoui1jHZPO5jhFkdCrhqJMsFYzjpqTNZheUZUZQ98hq4Lg4BEGe4auZTSaPItRjURJSVVkWN0ThQHOOB6wVnB//xN2OnL5HpMtlthMEMaPTHnC+RDTKZehO3ILcvryQN2usWGI8vfUmw2du0fcPeKcJkHb7Plr/gtTmWJDgTocsHlEeJwxTSmXa0LX+QxGcHvPOZ1S8vwbKtgjPZdm66HrI1E6w8nrgLd3y/s/E31dofOac6vpioJ///ub2/tIp3OUKpAyZbQtdmywlxaVlZi6Rdc106hQJscpX9a0fkCz8TlPOcP5SN6u0UpgXMEYZ5zijKbxMDahHTxMFlMvPaZzwvVcov0jU5yj1j7O88NvxO6KbLWmzwRSeBxe54jdgirdobMYG8fs9zNEuERsXlDlkdB94fZWc7tKhLfAdilGhjjN4GF1RvSyxKYZb5Wk9wUmSwjTZ0ZZMCYp9hTTyJDBFQxtjB/MaNs9ZeVip4ROhTzOfsbp4gKZZKRhyElrLmagtxWnS08U+Vwny1lrxlqhqpp2yNCDJBI+SpUoVdH31Se32wVO4e5ohSBcLumiiFNVUhYesg4YpwxT5/RRjAwCVB7z8PArWv9oN6IsPZomZLf7ilIxxsQ46XxOuV4T/vmVyQhavUEuN9jkSCVfuVxTtHVRww7V+9TNkveuYvR+3PWJMlnRrVxsINj//gdOmqZIKdlut7Rti6wlspGfHkUR1lqssahO0TTN56bTxNvtDc/zKIocYwx5nvPlyx3/A76lgs1kiR2KAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Figure 51\"\n        title=\"Figure 51\"\n        src=\"/note2-gatsby/static/d6bbc50b8f57760f49a4a16adb307122/f058b/Figure_51.png\"\n        srcset=\"/note2-gatsby/static/d6bbc50b8f57760f49a4a16adb307122/c26ae/Figure_51.png 158w,\n/note2-gatsby/static/d6bbc50b8f57760f49a4a16adb307122/6bdcf/Figure_51.png 315w,\n/note2-gatsby/static/d6bbc50b8f57760f49a4a16adb307122/f058b/Figure_51.png 630w,\n/note2-gatsby/static/d6bbc50b8f57760f49a4a16adb307122/fdaf8/Figure_51.png 674w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>少しだけではあるが精度は良くなったように見える。だが、もう少し精度を上げることはできないだろうか？</p>\n<p>ここで少し機械学習とはそれるが、画像処理の技術を適用することを次章で考えてみる。</p>","frontmatter":{"title":"手書き文字の認識","date":"October 29, 2019","description":"","tags":[]}}},"pageContext":{"id":"9f7b8a40-d75d-5c74-bbc5-ecf34aefd8e9"}},"staticQueryHashes":["2841359383","3257411868"]}